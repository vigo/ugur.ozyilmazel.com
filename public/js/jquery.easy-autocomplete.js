/*
 * easy-autocomplete
 * jQuery plugin for autocompletion
 * 
 * @author Łukasz Pawełczak (http://github.com/pawelczak)
 * @version 1.3.5
 * Copyright  License: 
 */
var EasyAutocomplete=function(scope){return scope.Configuration=function(options){function prepareDefaults(){if("xml"===options.dataType&&(options.getValue||(options.getValue=function(element){return $(element).text()}),options.list||(options.list={}),options.list.sort||(options.list.sort={}),options.list.sort.method=function(a,b){return a=options.getValue(a),b=options.getValue(b),a<b?-1:a>b?1:0},options.list.match||(options.list.match={}),options.list.match.method=function(element,phrase){return element.search(phrase)>-1}),options.categories!==undefined&&options.categories instanceof Array){for(var categories=[],i=0,length=options.categories.length;i<length;i+=1){var category=options.categories[i];for(var property in defaults.categories[0])category[property]===undefined&&(category[property]=defaults.categories[0][property]);categories.push(category)}options.categories=categories}}function mergeOptions(){function mergeObjects(source,target){var mergedObject=source||{};for(var propertyName in source)target[propertyName]!==undefined&&null!==target[propertyName]&&("object"!=typeof target[propertyName]||target[propertyName]instanceof Array?mergedObject[propertyName]=target[propertyName]:mergeObjects(source[propertyName],target[propertyName]));return target.data!==undefined&&null!==target.data&&"object"==typeof target.data&&(mergedObject.data=target.data),mergedObject}defaults=mergeObjects(defaults,options)}function processAfterMerge(){if("list-required"!==defaults.url&&"function"!=typeof defaults.url){var defaultUrl=defaults.url;defaults.url=function(){return defaultUrl}}if(defaults.ajaxSettings.url!==undefined&&"function"!=typeof defaults.ajaxSettings.url){var defaultUrl=defaults.ajaxSettings.url;defaults.ajaxSettings.url=function(){return defaultUrl}}if("string"==typeof defaults.listLocation){var defaultlistLocation=defaults.listLocation;"XML"===defaults.dataType.toUpperCase()?defaults.listLocation=function(data){return $(data).find(defaultlistLocation)}:defaults.listLocation=function(data){return data[defaultlistLocation]}}if("string"==typeof defaults.getValue){var defaultsGetValue=defaults.getValue;defaults.getValue=function(element){return element[defaultsGetValue]}}options.categories!==undefined&&(defaults.categoriesAssigned=!0)}function addAjaxSettings(){options.ajaxSettings!==undefined&&"object"==typeof options.ajaxSettings?defaults.ajaxSettings=options.ajaxSettings:defaults.ajaxSettings={}}function isAssigned(name){return defaults[name]!==undefined&&null!==defaults[name]}function printPropertiesThatDoesntExist(consol,optionsToCheck){function checkPropertiesIfExist(source,target){for(var property in target)source[property]===undefined&&consol.log("Property '"+property+"' does not exist in EasyAutocomplete options API."),"object"==typeof source[property]&&-1===$.inArray(property,externalObjects)&&checkPropertiesIfExist(source[property],target[property])}checkPropertiesIfExist(defaults,optionsToCheck)}var defaults={data:"list-required",url:"list-required",dataType:"json",listLocation:function(data){return data},xmlElementName:"",getValue:function(element){return element},autocompleteOff:!0,placeholder:!1,ajaxCallback:function(){},matchResponseProperty:!1,list:{sort:{enabled:!1,method:function(a,b){return a=defaults.getValue(a),b=defaults.getValue(b),a<b?-1:a>b?1:0}},maxNumberOfElements:6,hideOnEmptyPhrase:!0,match:{enabled:!1,caseSensitive:!1,method:function(element,phrase){return element.search(phrase)>-1}},showAnimation:{type:"normal",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},onClickEvent:function(){},onSelectItemEvent:function(){},onLoadEvent:function(){},onChooseEvent:function(){},onKeyEnterEvent:function(){},onMouseOverEvent:function(){},onMouseOutEvent:function(){},onShowListEvent:function(){},onHideListEvent:function(){}},highlightPhrase:!0,theme:"",cssClasses:"",minCharNumber:0,requestDelay:0,adjustWidth:!0,ajaxSettings:{},preparePostData:function(data){return data},loggerEnabled:!0,template:"",categoriesAssigned:!1,categories:[{maxNumberOfElements:4}]},externalObjects=["ajaxSettings","template"];this.get=function(propertyName){return defaults[propertyName]},this.equals=function(name,value){return!(!isAssigned(name)||defaults[name]!==value)},this.checkDataUrlProperties=function(){return"list-required"!==defaults.url||"list-required"!==defaults.data},this.checkRequiredProperties=function(){for(var propertyName in defaults)if("required"===defaults[propertyName])return logger.error("Option "+propertyName+" must be defined"),!1;return!0},this.printPropertiesThatDoesntExist=function(consol,optionsToCheck){printPropertiesThatDoesntExist(consol,optionsToCheck)},prepareDefaults(),mergeOptions(),!0===defaults.loggerEnabled&&printPropertiesThatDoesntExist(console,options),addAjaxSettings(),processAfterMerge()},scope}(EasyAutocomplete||{}),EasyAutocomplete=function(scope){return scope.Logger=function(){this.error=function(message){console.log("ERROR: "+message)},this.warning=function(message){console.log("WARNING: "+message)}},scope}(EasyAutocomplete||{}),EasyAutocomplete=function(scope){return scope.Constans=function(){var constants={CONTAINER_CLASS:"easy-autocomplete-container",CONTAINER_ID:"eac-container-",WRAPPER_CSS_CLASS:"easy-autocomplete"};this.getValue=function(propertyName){return constants[propertyName]}},scope}(EasyAutocomplete||{}),EasyAutocomplete=function(scope){return scope.ListBuilderService=function(configuration,proccessResponseData){function convertToListBuilder(category,data){function convertXmlToListBuilder(){var listLocation,builder={};return category.xmlElementName!==undefined&&(builder.xmlElementName=category.xmlElementName),category.listLocation!==undefined?listLocation=category.listLocation:configuration.get("listLocation")!==undefined&&(listLocation=configuration.get("listLocation")),listLocation!==undefined?"string"==typeof listLocation?builder.data=$(data).find(listLocation):"function"==typeof listLocation&&(builder.data=listLocation(data)):builder.data=data,builder}function convertDataToListBuilder(){var builder={};return category.listLocation!==undefined?"string"==typeof category.listLocation?builder.data=data[category.listLocation]:"function"==typeof category.listLocation&&(builder.data=category.listLocation(data)):builder.data=data,builder}var builder={};if(builder="XML"===configuration.get("dataType").toUpperCase()?convertXmlToListBuilder():convertDataToListBuilder(),category.header!==undefined&&(builder.header=category.header),category.maxNumberOfElements!==undefined&&(builder.maxNumberOfElements=category.maxNumberOfElements),configuration.get("list").maxNumberOfElements!==undefined&&(builder.maxListSize=configuration.get("list").maxNumberOfElements),category.getValue!==undefined)if("string"==typeof category.getValue){var defaultsGetValue=category.getValue;builder.getValue=function(element){return element[defaultsGetValue]}}else"function"==typeof category.getValue&&(builder.getValue=category.getValue);else builder.getValue=configuration.get("getValue");return builder}function convertXmlToList(builder){var simpleList=[];return builder.xmlElementName===undefined&&(builder.xmlElementName=configuration.get("xmlElementName")),$(builder.data).find(builder.xmlElementName).each(function(){simpleList.push(this)}),simpleList}this.init=function(data){var listBuilder=[],builder={};return builder.data=configuration.get("listLocation")(data),builder.getValue=configuration.get("getValue"),builder.maxListSize=configuration.get("list").maxNumberOfElements,listBuilder.push(builder),listBuilder},this.updateCategories=function(listBuilder,data){if(configuration.get("categoriesAssigned")){listBuilder=[];for(var i=0;i<configuration.get("categories").length;i+=1){var builder=convertToListBuilder(configuration.get("categories")[i],data);listBuilder.push(builder)}}return listBuilder},this.convertXml=function(listBuilder){if("XML"===configuration.get("dataType").toUpperCase())for(var i=0;i<listBuilder.length;i+=1)listBuilder[i].data=convertXmlToList(listBuilder[i]);return listBuilder},this.processData=function(listBuilder,inputPhrase){for(var i=0,length=listBuilder.length;i<length;i+=1)listBuilder[i].data=proccessResponseData(configuration,listBuilder[i],inputPhrase);return listBuilder},this.checkIfDataExists=function(listBuilders){for(var i=0,length=listBuilders.length;i<length;i+=1)if(listBuilders[i].data!==undefined&&listBuilders[i].data instanceof Array&&listBuilders[i].data.length>0)return!0;return!1}},scope}(EasyAutocomplete||{}),EasyAutocomplete=function(scope){return scope.proccess=function(config,listBuilder,phrase){function findMatch(list,phrase){var preparedList=[],value="";if(config.get("list").match.enabled)for(var i=0,length=list.length;i<length;i+=1)value=config.get("getValue")(list[i]),match(value,phrase)&&preparedList.push(list[i]);else preparedList=list;return preparedList}function match(value,phrase){return config.get("list").match.caseSensitive||("string"==typeof value&&(value=value.toLowerCase()),phrase=phrase.toLowerCase()),!!config.get("list").match.method(value,phrase)}function reduceElementsInList(list){return listBuilder.maxNumberOfElements!==undefined&&list.length>listBuilder.maxNumberOfElements&&(list=list.slice(0,listBuilder.maxNumberOfElements)),list}function sort(list){return config.get("list").sort.enabled&&list.sort(config.get("list").sort.method),list}scope.proccess.match=match;var list=listBuilder.data;return list=findMatch(list,phrase),list=reduceElementsInList(list),list=sort(list)},scope}(EasyAutocomplete||{}),EasyAutocomplete=function(scope){return scope.Template=function(options){var genericTemplates={basic:{type:"basic",method:function(element){return element},cssClass:""},description:{type:"description",fields:{description:"description"},method:function(element){return element+" - description"},cssClass:"eac-description"},iconLeft:{type:"iconLeft",fields:{icon:""},method:function(element){return element},cssClass:"eac-icon-left"},iconRight:{type:"iconRight",fields:{iconSrc:""},method:function(element){return element},cssClass:"eac-icon-right"},links:{type:"links",fields:{link:""},method:function(element){return element},cssClass:""},custom:{type:"custom",method:function(){},cssClass:""}},convertTemplateToMethod=function(template){var buildMethod,_fields=template.fields;return"description"===template.type?(buildMethod=genericTemplates.description.method,"string"==typeof _fields.description?buildMethod=function(elementValue,element){return elementValue+" - <span>"+element[_fields.description]+"</span>"}:"function"==typeof _fields.description&&(buildMethod=function(elementValue,element){return elementValue+" - <span>"+_fields.description(element)+"</span>"}),buildMethod):"iconRight"===template.type?("string"==typeof _fields.iconSrc?buildMethod=function(elementValue,element){return elementValue+"<img class='eac-icon' src='"+element[_fields.iconSrc]+"' />"}:"function"==typeof _fields.iconSrc&&(buildMethod=function(elementValue,element){return elementValue+"<img class='eac-icon' src='"+_fields.iconSrc(element)+"' />"}),buildMethod):"iconLeft"===template.type?("string"==typeof _fields.iconSrc?buildMethod=function(elementValue,element){return"<img class='eac-icon' src='"+element[_fields.iconSrc]+"' />"+elementValue}:"function"==typeof _fields.iconSrc&&(buildMethod=function(elementValue,element){return"<img class='eac-icon' src='"+_fields.iconSrc(element)+"' />"+elementValue}),buildMethod):"links"===template.type?("string"==typeof _fields.link?buildMethod=function(elementValue,element){return"<a href='"+element[_fields.link]+"' >"+elementValue+"</a>"}:"function"==typeof _fields.link&&(buildMethod=function(elementValue,element){return"<a href='"+_fields.link(element)+"' >"+elementValue+"</a>"}),buildMethod):"custom"===template.type?template.method:genericTemplates.basic.method},prepareBuildMethod=function(options){return options&&options.type&&options.type&&genericTemplates[options.type]?convertTemplateToMethod(options):genericTemplates.basic.method},templateClass=function(options){var emptyStringFunction=function(){return""};return options&&options.type&&options.type&&genericTemplates[options.type]?function(){var _cssClass=genericTemplates[options.type].cssClass;return function(){return _cssClass}}():emptyStringFunction};this.getTemplateClass=templateClass(options),this.build=prepareBuildMethod(options)},scope}(EasyAutocomplete||{}),EasyAutocomplete=function(scope){return scope.main=function($input,options){function init(){return 0===$field.length?void logger.error("Input field doesn't exist."):config.checkDataUrlProperties()?config.checkRequiredProperties()?(prepareField(),void bindEvents()):void logger.error("Will not work without mentioned properties."):void logger.error("One of options variables 'data' or 'url' must be defined.")}function prepareField(){function createWrapper(){var $wrapper=$("<div>"),classes=consts.getValue("WRAPPER_CSS_CLASS");config.get("theme")&&""!==config.get("theme")&&(classes+=" eac-"+config.get("theme")),config.get("cssClasses")&&""!==config.get("cssClasses")&&(classes+=" "+config.get("cssClasses")),""!==template.getTemplateClass()&&(classes+=" "+template.getTemplateClass()),$wrapper.addClass(classes),$field.wrap($wrapper),!0===config.get("adjustWidth")&&adjustWrapperWidth()}function adjustWrapperWidth(){var fieldWidth=$field.outerWidth();$field.parent().css("width",fieldWidth)}function removeWrapper(){$field.unwrap()}function createContainer(){var $elements_container=$("<div>").addClass(consts.getValue("CONTAINER_CLASS"));$elements_container.attr("id",getContainerId()).prepend($("<ul>")),function(){$elements_container.on("show.eac",function(){switch(config.get("list").showAnimation.type){case"slide":var animationTime=config.get("list").showAnimation.time,callback=config.get("list").showAnimation.callback;$elements_container.find("ul").slideDown(animationTime,callback);break;case"fade":var animationTime=config.get("list").showAnimation.time,callback=config.get("list").showAnimation.callback;$elements_container.find("ul").fadeIn(animationTime);break;default:$elements_container.find("ul").show()}config.get("list").onShowListEvent()}).on("hide.eac",function(){switch(config.get("list").hideAnimation.type){case"slide":var animationTime=config.get("list").hideAnimation.time,callback=config.get("list").hideAnimation.callback;$elements_container.find("ul").slideUp(animationTime,callback);break;case"fade":var animationTime=config.get("list").hideAnimation.time,callback=config.get("list").hideAnimation.callback;$elements_container.find("ul").fadeOut(animationTime,callback);break;default:$elements_container.find("ul").hide()}config.get("list").onHideListEvent()}).on("selectElement.eac",function(){$elements_container.find("ul li").removeClass("selected"),$elements_container.find("ul li").eq(selectedElement).addClass("selected"),config.get("list").onSelectItemEvent()}).on("loadElements.eac",function(event,listBuilders,phrase){var $item="",$listContainer=$elements_container.find("ul");$listContainer.empty().detach(),elementsList=[];for(var counter=0,builderIndex=0,listBuildersLength=listBuilders.length;builderIndex<listBuildersLength;builderIndex+=1){var listData=listBuilders[builderIndex].data;if(0!==listData.length){listBuilders[builderIndex].header!==undefined&&listBuilders[builderIndex].header.length>0&&$listContainer.append("<div class='eac-category' >"+listBuilders[builderIndex].header+"</div>");for(var i=0,listDataLength=listData.length;i<listDataLength&&counter<listBuilders[builderIndex].maxListSize;i+=1)$item=$("<li><div class='eac-item'></div></li>"),function(){var j=i,itemCounter=counter,elementsValue=listBuilders[builderIndex].getValue(listData[j]);$item.find(" > div").on("click",function(){$field.val(elementsValue).trigger("change"),selectedElement=itemCounter,selectElement(itemCounter),config.get("list").onClickEvent(),config.get("list").onChooseEvent()}).mouseover(function(){selectedElement=itemCounter,selectElement(itemCounter),config.get("list").onMouseOverEvent()}).mouseout(function(){config.get("list").onMouseOutEvent()}).html(template.build(highlight(elementsValue,phrase),listData[j]))}(),$listContainer.append($item),elementsList.push(listData[i]),counter+=1}}$elements_container.append($listContainer),config.get("list").onLoadEvent()})}(),$field.after($elements_container)}function removeContainer(){$field.next("."+consts.getValue("CONTAINER_CLASS")).remove()}function highlight(string,phrase){return config.get("highlightPhrase")&&""!==phrase?highlightPhrase(string,phrase):string}function escapeRegExp(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function highlightPhrase(string,phrase){var escapedPhrase=escapeRegExp(phrase);return(string+"").replace(new RegExp("("+escapedPhrase+")","gi"),"<b>$1</b>")}$field.parent().hasClass(consts.getValue("WRAPPER_CSS_CLASS"))&&(removeContainer(),removeWrapper()),createWrapper(),createContainer(),$container=$("#"+getContainerId()),config.get("placeholder")&&$field.attr("placeholder",config.get("placeholder"))}function getContainerId(){var elementId=$field.attr("id");return elementId=consts.getValue("CONTAINER_ID")+elementId}function bindEvents(){function bindAllEvents(){checkParam("autocompleteOff",!0)&&removeAutocomplete(),bindFocusOut(),bindKeyup(),bindKeydown(),bindKeypress(),bindFocus(),bindBlur()}function bindFocusOut(){$field.focusout(function(){var phrase,fieldValue=$field.val();config.get("list").match.caseSensitive||(fieldValue=fieldValue.toLowerCase());for(var i=0,length=elementsList.length;i<length;i+=1)if(phrase=config.get("getValue")(elementsList[i]),config.get("list").match.caseSensitive||(phrase=phrase.toLowerCase()),phrase===fieldValue)return selectedElement=i,void selectElement(selectedElement)})}function bindKeyup(){$field.off("keyup").keyup(function(event){function loadData(inputPhrase){function createAjaxSettings(){var settings={},ajaxSettings=config.get("ajaxSettings")||{};for(var set in ajaxSettings)settings[set]=ajaxSettings[set];return settings}function checkInputPhraseMatchResponse(inputPhrase,data){return!1===config.get("matchResponseProperty")||("string"==typeof config.get("matchResponseProperty")?data[config.get("matchResponseProperty")]===inputPhrase:"function"!=typeof config.get("matchResponseProperty")||config.get("matchResponseProperty")(data)===inputPhrase)}if(!(inputPhrase.length<config.get("minCharNumber"))){if("list-required"!==config.get("data")){var data=config.get("data"),listBuilders=listBuilderService.init(data);listBuilders=listBuilderService.updateCategories(listBuilders,data),listBuilders=listBuilderService.processData(listBuilders,inputPhrase),loadElements(listBuilders,inputPhrase),$field.parent().find("li").length>0?showContainer():hideContainer()}var settings=createAjaxSettings();settings.url!==undefined&&""!==settings.url||(settings.url=config.get("url")),settings.dataType!==undefined&&""!==settings.dataType||(settings.dataType=config.get("dataType")),settings.url!==undefined&&"list-required"!==settings.url&&(settings.url=settings.url(inputPhrase),settings.data=config.get("preparePostData")(settings.data,inputPhrase),$.ajax(settings).done(function(data){var listBuilders=listBuilderService.init(data);listBuilders=listBuilderService.updateCategories(listBuilders,data),listBuilders=listBuilderService.convertXml(listBuilders),checkInputPhraseMatchResponse(inputPhrase,data)&&(listBuilders=listBuilderService.processData(listBuilders,inputPhrase),loadElements(listBuilders,inputPhrase)),listBuilderService.checkIfDataExists(listBuilders)&&$field.parent().find("li").length>0?showContainer():hideContainer(),config.get("ajaxCallback")()}).fail(function(){logger.warning("Fail to load response data")}).always(function(){}))}}switch(event.keyCode){case 27:hideContainer(),loseFieldFocus();break;case 38:event.preventDefault(),elementsList.length>0&&selectedElement>0&&(selectedElement-=1,$field.val(config.get("getValue")(elementsList[selectedElement])),selectElement(selectedElement));break;case 40:event.preventDefault(),elementsList.length>0&&selectedElement<elementsList.length-1&&(selectedElement+=1,$field.val(config.get("getValue")(elementsList[selectedElement])),selectElement(selectedElement));break;default:if(event.keyCode>40||8===event.keyCode){var inputPhrase=$field.val();!0!==config.get("list").hideOnEmptyPhrase||8!==event.keyCode||""!==inputPhrase?config.get("requestDelay")>0?(requestDelayTimeoutId!==undefined&&clearTimeout(requestDelayTimeoutId),requestDelayTimeoutId=setTimeout(function(){loadData(inputPhrase)},config.get("requestDelay"))):loadData(inputPhrase):hideContainer()}}})}function bindKeydown(){$field.on("keydown",function(evt){if(evt=evt||window.event,38===evt.keyCode)return suppressKeypress=!0,!1}).keydown(function(event){13===event.keyCode&&selectedElement>-1&&($field.val(config.get("getValue")(elementsList[selectedElement])),config.get("list").onKeyEnterEvent(),config.get("list").onChooseEvent(),selectedElement=-1,hideContainer(),event.preventDefault())})}function bindKeypress(){$field.off("keypress")}function bindFocus(){$field.focus(function(){""!==$field.val()&&elementsList.length>0&&(selectedElement=-1,showContainer())})}function bindBlur(){$field.blur(function(){setTimeout(function(){selectedElement=-1,hideContainer()},250)})}function removeAutocomplete(){$field.attr("autocomplete","off")}bindAllEvents()}function showContainer(){$container.trigger("show.eac")}function hideContainer(){$container.trigger("hide.eac")}function selectElement(index){$container.trigger("selectElement.eac",index)}function loadElements(list,phrase){$container.trigger("loadElements.eac",[list,phrase])}function loseFieldFocus(){$field.trigger("blur")}var requestDelayTimeoutId,consts=new scope.Constans,config=new scope.Configuration(options),logger=new scope.Logger,template=new scope.Template(options.template),listBuilderService=new scope.ListBuilderService(config,scope.proccess),checkParam=config.equals,$field=$input,$container="",elementsList=[],selectedElement=-1;scope.consts=consts,this.getConstants=function(){return consts},this.getConfiguration=function(){return config},this.getContainer=function(){return $container},this.getSelectedItemIndex=function(){return selectedElement},this.getItems=function(){return elementsList},this.getItemData=function(index){return elementsList.length<index||elementsList[index]===undefined?-1:elementsList[index]},this.getSelectedItemData=function(){return this.getItemData(selectedElement)},this.build=function(){prepareField()},this.init=function(){init()}},scope.eacHandles=[],scope.getHandle=function(id){return scope.eacHandles[id]},scope.inputHasId=function(input){return $(input).attr("id")!==undefined&&$(input).attr("id").length>0},scope.assignRandomId=function(input){var fieldId="";do{fieldId="eac-"+Math.floor(1e4*Math.random())}while(0!==$("#"+fieldId).length);elementId=scope.consts.getValue("CONTAINER_ID")+fieldId,$(input).attr("id",fieldId)},scope.setHandle=function(handle,id){scope.eacHandles[id]=handle},scope}(EasyAutocomplete||{});!function($){$.fn.easyAutocomplete=function(options){return this.each(function(){var $this=$(this),eacHandle=new EasyAutocomplete.main($this,options);EasyAutocomplete.inputHasId($this)||EasyAutocomplete.assignRandomId($this),eacHandle.init(),EasyAutocomplete.setHandle(eacHandle,$this.attr("id"))})},$.fn.getSelectedItemIndex=function(){var inputId=$(this).attr("id");return inputId!==undefined?EasyAutocomplete.getHandle(inputId).getSelectedItemIndex():-1},$.fn.getItems=function(){var inputId=$(this).attr("id");return inputId!==undefined?EasyAutocomplete.getHandle(inputId).getItems():-1},$.fn.getItemData=function(index){var inputId=$(this).attr("id");return inputId!==undefined&&index>-1?EasyAutocomplete.getHandle(inputId).getItemData(index):-1},$.fn.getSelectedItemData=function(){var inputId=$(this).attr("id");return inputId!==undefined?EasyAutocomplete.getHandle(inputId).getSelectedItemData():-1}}(jQuery);