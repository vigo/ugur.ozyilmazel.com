
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Fix Middleman Live Reload - Uğur “vigo” Özyılmazel</title>
        <link rel="alternate" type="application/atom+xml" title="Atom Feed (Türkçe)" href="/feed-tr.xml" />
        <link rel="alternate" type="application/atom+xml" title="Atom Feed (English)" href="/feed-en.xml" />

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
        <script src="https://kit.fontawesome.com/ebc2456445.js" crossorigin="anonymous"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

        <link href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

        <link href="/public/css/syntax.css" rel="stylesheet" />
        <link href="/public/css/application.css" rel="stylesheet" />
    

        <script src="/public/js/application.js"></script>
    
        <meta name="date" content="2025-03-11T19:26:27+03:00" />
        <meta name="description" content="Package updates in Ruby projects have always made me uneasy. Usually, after an update, something always breaks or throws an error." />
        <meta name="author" content="Uğur “vigo” Özyılmazel"/>
        <meta name="copyright" content="(c) 2006 / 2025 - Uğur “vigo” Özyılmazel" />
        <meta property="og:url" content="https://ugur.ozyilmazel.com/blog/en/2025/03/11/fix-middleman-live-reload/" />
        <meta property="og:title" content="Fix Middleman Live Reload" />
        <meta property="og:site_name" content="vigo" />
        <meta property="og:type" content="website" />
        <meta property="og:description" content="Package updates in Ruby projects have always made me uneasy. Usually, after an update, something always breaks or throws an error." />
        <meta property="og:image" content="https://ugur.ozyilmazel.com/public/images/og/ugur-vigo-ozyilmazel-500x500.jpg" />
        <meta property="og:image:type" content="image/jpeg" />
        <meta property="og:image:width" content="500" />
        <meta property="og:image:height" content="500" />

    <link href="/public/images/favicon.png" rel="shortcut icon" type="image/png" />
    </head>
<body>
    
    
    <section class="section menu">
    <div class="container">
        <nav class="level is-mobile">
            <div class="level-left">
<div class="level-item"><a href="/en/">Home</a></div><div class="level-item"><a href="/blog/en/" class="is-active">Blog Archive</a></div><div class="level-item"><a href="/page/en/about/">About</a></div>            </div>
            <div class="level-right">
<div class="level-item"><a href="https://vbyazilim.com" target="_blank">VB</a></div><div class="level-item"><a href="/">TR</a></div>            </div>
        </nav>
    </div>
</section>

    
        <section class="hero is-medium cover is-hidden-touch" style="background-image: url(/public/images/covers/2014-11-25-middleman.png);">
        <div class="hero-body">
            <div class="container has-text-left">
                
                
            </div>
        </div>
    </section>
  
    
    
    <section class="section main">
        <div class="container">
        
            <div class="columns is-multiline is-variable is-8">
                <div class="column is-9-desktop is-full-tablet">
                    <div class="content is-large">

                        <article>
                            <div class="meta">
                                <span class="reading-time">READING TIME 02:06</span>
                                &mdash;
                                <time pubdate datetime="2025-03-11T18:55:00+03:00" title="Tuesday, March 11, 2025, 6:55 PM">Tuesday, March 11, 2025, 6:55 PM</time>


                                <div class="tags mt-3">
                                </div>

                            </div>
                            
                            <h1 class="title">Fix Middleman Live Reload</h1>
                            
                            <div class="yield"><p>Package updates in Ruby projects have always made me uneasy. Usually, after an
update, something always breaks or throws an error. </p>

<p>I rarely add posts to my blog — sometimes every 3–4 months, sometimes once a
year. Whenever I decide to write a new post, I tell myself</p>

<blockquote>
<p>Wait, let’s update the packages first.</p>
</blockquote>

<p>Big mistake. It never fails—every single time I sit down to write, I somehow
end up battling Ruby versions or package dependencies instead.</p>

<p>A few days ago, I got excited again and decided to write a blog post. I
checked GitHub, and <code>dependabot</code> had opened some PRs. I noticed an update for
<code>middleman-core</code>. With my fingers crossed, I merged dependabot’s PRs.</p>

<p>Oh my bash! The most useful feature when writing blog posts is live-reload, and guess
what? <strong>It wasn’t working</strong>. </p>

<p>I checked the Firefox console, and <code>webrick</code> was returning a <code>500</code> http error.
The reason? The incoming HTTP headers had uppercase keys, like <code>Content-Type</code>.</p>

<p>Anyway, I told myself;</p>

<blockquote>
<p>Let’s not deal with this now.</p>
</blockquote>

<p>So, I disabled the live reload feature, finished my post, and published it.</p>

<p>After that, I turned to the greatest invention of our time—ChatGPT and other
LLMs—to explain the issue and ask for help. No luck.</p>

<p>Google? Stack Overflow? Nothing. Of course, it was up to me to fix it.</p>

<p>For the past <strong>six years</strong>, I’ve been developing with <code>go</code>, so I’ve been following
the <code>ruby</code> ecosystem from a distance. To keep my <code>ruby</code> skills from fading, I
mostly tinker with <code>Rakefiles</code>. Because of that, I expected this issue to be a
bit challenging—but surprisingly, it was an easy fix!.</p>

<p>First, I ran Middleman in verbose mode:</p>
<div class="highlight"><pre class="highlight shell"><code>bin/middleman serve <span class="nt">--verbose</span>
</code></pre></div>
<p>and here was the error:</p>
<div class="highlight"><pre class="highlight plaintext"><code>[2025-03-11 18:10:15] ERROR Rack::Lint::LintError: uppercase character in header name: Content-Type
    /private/tmp/my_project/vendor/bundle/ruby/3.3.0/gems/rack-3.1.12/lib/rack/lint.rb:717:in `block in check_headers'
</code></pre></div>
<p>Opened the file <code>vendor/bundle/ruby/3.3.0/gems/rack-3.1.12/lib/rack/lint.rb:717</code>
and commented out:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="c1">## Header keys must not contain uppercase ASCII characters (A-Z).</span>
<span class="c1"># raise LintError, "uppercase character in header name: #{key}" if key =~ /[A-Z]/</span>
<span class="c1"># ^ this line</span>
</code></pre></div>
<p>and it worked! Now, it’s time to use some <strong>ruby magic</strong> to override/implement
a custom <strong>Rack middleware</strong> to that! I undo the comment, and implemented:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="c1"># lib/middleware/rack/downcase_headers.rb</span>
<span class="k">module</span> <span class="nn">Rack</span>
  <span class="k">class</span> <span class="nc">DowncaseHeaders</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
      <span class="vi">@app</span> <span class="o">=</span> <span class="n">app</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
      <span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="vi">@app</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
      <span class="n">new_headers</span> <span class="o">=</span> <span class="n">headers</span><span class="p">.</span><span class="nf">transform_keys</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:downcase</span><span class="p">)</span>
      <span class="p">[</span><span class="n">status</span><span class="p">,</span> <span class="n">new_headers</span><span class="p">,</span> <span class="n">body</span><span class="p">]</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>Now, updated my <code>config.rb</code>:</p>
<div class="highlight"><pre class="highlight ruby"><code><span class="c1"># ...</span>

<span class="nb">require_relative</span> <span class="s1">'lib/middleware/rack/downcase_headers'</span>

<span class="c1"># ...</span>

<span class="n">configure</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">use</span> <span class="o">::</span><span class="no">Rack</span><span class="o">::</span><span class="no">DowncaseHeaders</span>
  <span class="n">activate</span> <span class="ss">:livereload</span><span class="p">,</span> <span class="ss">host: </span><span class="s1">'127.0.0.1'</span>
<span class="k">end</span>
</code></pre></div>
<p>That’s it! <strong>Live reload</strong> is back in business!</p>

<p>This is just a basic monkey patch. The Middleman team or the live-reload team
will probably fix this in the future, but until then, I’ll stick with this
workaround.</p>

<p>Files can be found:</p>

<ul>
<li><a href="https://github.com/vigo/ugur.ozyilmazel.com/blob/main/lib/middleware/rack/downcase_headers.rb">downcase_headers.rb</a></li>
<li><a href="https://github.com/vigo/ugur.ozyilmazel.com/blob/main/config.rb">config.rb</a></li>
</ul>

<p>The versions of gems are:</p>

<ul>
<li><code>em-websocket (0.5.3)</code></li>
<li><code>middleman (4.6.0)</code></li>
<li><code>middleman-livereload (3.4.7)</code></li>
<li><code>rack (3.1.12)</code></li>
<li><code>rack-livereload (0.3.17)</code></li>
<li><code>webrick (1.9.1)</code></li>
</ul>
</div>
                        </article>
                        
                            <nav class="mt-6 pagination is-centered" role="navigation" aria-label="pagination">
                                <a href="/blog/en/2024/05/21/django-natural-key/" class="pagination-previous has-text-link">&laquo; Django Natural Key</a>
                                
                            </nav>

                    </div>
                </div>

                <div class="column is-3-desktop is-full-tablet">
                    <div class="content">
                        

                        <div class="blog-post-list sidebar">
    <h1>By Year</h1>
    <p>There are “7” posts in blog archive.</p>
<p><a href="/blog/en/year/2025/" class="">2025 has 1 post</a></p><p><a href="/blog/en/year/2024/" class="">2024 has 1 post</a></p><p><a href="/blog/en/year/2022/" class="">2022 has 3 posts</a></p><p><a href="/blog/en/year/2019/" class="">2019 has 1 post</a></p><p><a href="/blog/en/year/2016/" class="">2016 has 1 post</a></p></div>
                        
                    </div>
                </div>
            </div>

        </div>
    </section>


    <footer class="footer">
    <div class="container">
        <div class="content">
            <a href="/feed-en.xml" title="RSS Subscription">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-solid fa-square-rss fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://github.com/sponsors/vigo" title="GitHub Sponsorship">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-solid fa-heart fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://patreon.com/vigoo" title="Patreon Sponsorship">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-brands fa-patreon fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://github.com/vigo" title="GitHub Profile">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-brands fa-github fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://github.com/vbyazilim" title="VB YAZILIM GitHub Profile">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-brands fa-github fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://hub.docker.com/u/vigo/" title="Dockerhub Profile">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-brands fa-docker fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://www.linkedin.com/in/ugurozyilmazel" title="LinkedIn Profile">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-brands fa-linkedin fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://www.linkedin.com/company/vbyazilim/" title="VB YAZILIM LinkedIn Profile">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-brands fa-linkedin fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://rubygems.org/profiles/vigo" title="Rubygems Profile">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-solid fa-laptop-code fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://pypi.org/user/vigo" title="Python Package Index Profile">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-solid fa-laptop-code fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://vigos.hashnode.dev/" title="Hashnode Profile">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-brands fa-hashnode fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://opensource-heroes.com/u/vigo" title="Open Source Heroes Profile">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-brands fa-osi fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://dev.to/vigo" title="Dev Community Profile">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-brands fa-dev fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://csdb.dk/scener/?id=8379" title="CSDB">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-solid fa-cube fa-stack-1x"></i></span>
            </a>
            <a target="_blank" href="https://www.pouet.net/user.php?who=4721" title="Pouet">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-solid fa-cube fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="http://janeway.exotica.org.uk/author.php?id=11962" title="Amiga Exotica">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-solid fa-cube fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://demozoo.org/sceners/6273" title="Demozoo">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-solid fa-cube fa-stack-1x"></i></span>
            </a>

            <a target="_blank" href="https://www.demoparty.net/users/vigo" title="Demoparty.net">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-solid fa-cube fa-stack-1x"></i></span>
            </a>
            
            <script type="text/javascript">
            document.write('<a href="mailto:');
            document.write("hthebmlvyznmry\100tznvy\056pbz".replace(/[a-zA-Z]/g, function(c){return String.fromCharCode((c<="Z"?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26);}));
            document.write('" title="E-Mail"');
            document.write('<span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fa-solid fa-at fa-stack-1x"></i></span>');
            document.write('</a>');
            </script>

            <a target="_blank" href="https://vbyazilim.com/" title="My Company: VB YAZILIM">
                <span class="fa-stack" style="vertical-align: top;"><i class="fa-regular fa-circle fa-stack-2x"></i><i class="fas fa-building fa-stack-1x"></i></span>
            </a>

        </div>
    </div>
</footer>



</body>
</html>